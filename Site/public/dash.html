<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboards</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./assets/style/style.css">
    <link rel="stylesheet" href="./assets/style/sidebar.css">
    <link rel="stylesheet" href="./assets/style/quiz.css">
    <link rel="stylesheet" href="./assets/style/dashboard.css">
    <link rel="icon" href="./assets/imgs/iconSite.png">

</head>

<body onload="obterDadosGrafico(); obterDadosEstacao(); obterDadosMedia(); mudarTemaSide(); mudarCorTexto()">

    <section class="sidebar">
        <img src="assets/imgs/menu.svg" alt="" onclick="mostrarConteudo()" id="mostrarSide">
        <div class="container" id="crescerSide">
            <img src="assets/imgs/close.svg" alt="" id="fecharSide" onclick="mostrarConteudo()">
            <img src="assets/imgs/iconSite.png" alt="">
            <div class="link">
                <button class="botaoSide" onclick="redirecionarInicio()">Início</button>
                <button class="botaoSide" onclick="redirecionarQuiz()">Quiz</button>
                <button class="botaoSide" onclick="redirecionarDash()">Dashboards</button>
            </div>
        </div>
    </section>

    <section class="scrollBar">

    <section class="acertosQuiz">
        
        <div class="organizarKPI"> 
            <div class="titulo">Bem-vindo <span id="nomeUsuario"></span>!</div>
        <div class="kpi">
            Sua estação preferida é: <span id="estacaoDoUsuario"></span>
        </div> 
         <div class="kpi">
            Sua média de acertos é: <span id="mediaUsuario"></span>
        </div>
    </div>
        <div class="container">
            <div class="texto">
                <span class="imgSpan" onclick="mostrarModalAcertos()"><img src="assets/imgs/info.svg" alt="" ></span>Total de acertos:
            </div>
            <canvas id="graficoQuiz"></canvas>
        </div>

    </section>

    <section class="comunidade">
        <div class="container">
            <div class="graficoEstacao">
                <div class="texto">
                    Preferência de estação dos usuários:<span class="imgSpan"><img src="assets/imgs/info.svg" alt="" onclick="mostrarModalEstacao()"></span>
                </div>
                <canvas id="graficoEstacao"></canvas>
            </div>
            <div class="graficoMedia">
                <div class="texto">
                    <span class="imgSpan"><img src="assets/imgs/info.svg" alt="" onclick="mostrarModalMedia()"></span> Média de acertos geral:
                </div>
                <canvas id="graficoQuizMedia"></canvas>
            </div>
        </div>
    </section>
</section>

<div class="modals" id="modal">
    <div class="conteudoModal" >
        <span id="modalAcertos">
            <h1> <img src="assets/imgs/infoPreto.svg" alt="">Total de acertos:</h1>
            Este gráfico de barras representa o número de questões acertadas no quiz de La la land, mostrando os acertos de cada tentativa, em ordem.</span> 
        <span id="modalMedia">
            <h1> <img src="assets/imgs/infoPreto.svg" alt="">Média de acertos:</h1>
            Este gráfico de barras representa a média geral de questões acertadas no quiz de La la land, mostrando a média de acertos contando todos os usuários que fizeram o quiz.</span> 
        <span id="modalEstacao">
            <h1> <img src="assets/imgs/infoPreto.svg" alt="">Preferência de estação:</h1>
            Este gráfico de donuts representa a preferência da estação do ano dos usuários, mostrando o número total de pessoas que preferem o inverno, primavera, verão ou outono.</span> 
        <button onclick="fecharModal()">Entendi</button>
    </div>
</section>

</body>

</html>
<script src="js/sidebar.js"></script>
<script src="js/modal.js"></script>
<script>
    function buscarMediaAcertos(){
        fetch(`/dashboard/buscarAcertosMedia/`, {
            method:"POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkusuario: sessionStorage.getItem("ID_USUARIO")
            })
            }).then(
            function(resultado){
            resultado.json().then(function(json){
                console.log(json)
                document.getElementById("mediaUsuario").innerText = json[0].media_usuario
            })  
                    })
            }buscarMediaAcertos()
    

    function obterDadosGrafico() {
        let corDash = null

        if (sessionStorage.getItem("ESTACAO_USUARIO") == "Inverno") {
            corDash = '#00008B'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Outono") {
            corDash = 'rgb(39, 45, 63)'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Primavera") {
            corDash = '#8F00FF'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Verão") {
            corDash = '#008000'
        }

        fetch(`/dashboard/buscarAcertos/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                fkusuario: sessionStorage.getItem("ID_USUARIO")
            })
        }).then(
            function (resultado) {
                console.log(resultado)

                resultado.json().then(
                    function (json) {
                        let labels = []
                        let acertos = []

                        console.log(json)

                        for (let i = 0; i < json.length; i++) {
                            labels.push(`Tentativa: ${i + 1}`)
                            acertos.push(json[i].acertos)
                        }
                        const graficoAcerto = document.getElementById("graficoQuiz")

                        new Chart(graficoAcerto, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        weight: 5,
                                        data: acertos,
                                        borderColor: corDash,
                                        backgroundColor: corDash,
                                        fill: true,
                                        borderRadius: 5,
                                        color: '#fff',
                                    }
                                ]
                            },
                            options: {
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        ticks: {
                                            stepSize: 50,
                                            padding: 10
                                        },
                                        grid: {
                                            display: false
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });
                    }
                )

            }
        ).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        })
    }

    ;


    function obterDadosEstacao() {
        let total = 4

        let corDash = null

        if (sessionStorage.getItem("ESTACAO_USUARIO") == "Inverno") {
            corDash = '#00008B'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Outono") {
            corDash = 'rgb(39, 45, 63)'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Primavera") {
            corDash = '#8F00FF'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Verão") {
            corDash = '#008000'
        }

        fetch(`/usuarios/buscandoEstacao/`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            },
        }).then(function (resultado) {
            console.log(resultado)

            resultado.json().then(
                function (json) {
                    let labels = []
                    let estacao = []

                    console.log(json)

                    for (let i = 0; i < json.length; i++) {
                        labels.push(json[i].estacao)
                        estacao.push(json[i].total)
                        console.log()
                    }
                    const graficoEstacao = document.getElementById("graficoEstacao")

                    new Chart(graficoEstacao, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    weight: 5,
                                    borderRadius: 5,
                                    label: `Estacao`,
                                    data: estacao,
                                    borderColor: '',
                                    backgroundColor: [
                                        '#B3EBF2', // inverno
                                        '#B39EB5', //primavera
                                        '#80EF80', // verao
                                        '#CFCFC4' // outono
                                    ],
                                    fill: true,
                                    color: '#fff',
                                    order: 2
                                }
                            ]
                        },
                        options: {
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        stepSize: 50,
                                        padding: 10
                                    },
                                    grid: {
                                        display: false
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            }
                        }
                    });
                }
            )

        }
        ).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    }

    function obterDadosMedia() {
        let corDash = null

        if (sessionStorage.getItem("ESTACAO_USUARIO") == "Inverno") {
            corDash = '#00008B'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Outono") {
            corDash = 'rgb(39, 45, 63)'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Primavera") {
            corDash = '#8F00FF'
        } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Verão") {
            corDash = '#008000'
        }

        fetch(`/dashboard/buscarAcertosTotal/`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            },
        }).then(
            function (resultado) {
                console.log(resultado)

                resultado.json().then(
                    function (json) {
                        let labels = []
                        let media_acertos = []

                        console.log(json)

                        for (let i = 0; i < json.length; i++) {
                            labels.push(`Média: `)
                            media_acertos.push(json[i].media_acertos)
                        }
                        const graficoAcertoTotal = document.getElementById("graficoQuizMedia")

                        new Chart(graficoAcertoTotal, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        weight: 5,
                                        data: media_acertos,
                                        borderColor: corDash,
                                        backgroundColor: corDash,
                                        fill: true,
                                        borderRadius: 5,
                                        color: '#fff',
                                    }
                                ]
                            },
                            options: {
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                scales: {
                                    y: {
                                        ticks: {
                                            stepSize: 50,
                                            padding: 10
                                        },
                                        grid: {
                                            display: false
                                        }
                                    },
                                    x: {
                                        grid: {
                                            display: false
                                        }
                                    }
                                }
                            }
                        });
                    }
                )

            }
        ).catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        })
    }

    function pegarDados(){
        document.getElementById("estacaoDoUsuario").innerText = sessionStorage.ESTACAO_USUARIO
        document.getElementById("nomeUsuario").innerText = sessionStorage.NOME_USUARIO
    }pegarDados()

    function mudarCorTexto(){
        const root = document.documentElement;

    if (sessionStorage.getItem("ESTACAO_USUARIO") == "Inverno") {
        root.style.setProperty('--corTextokpi', '#9FB7E3');
        root.style.setProperty('--corBG', '#6495ed');

    } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Outono") {
        root.style.setProperty('--corTextokpi', '#8A8C8D');
        root.style.setProperty('--corBG', '#7c7a8d');


    } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Primavera") {
        root.style.setProperty('--corTextokpi', '#5D2896');
        root.style.setProperty('--corBG', '#9295D0');

    } else if (sessionStorage.getItem("ESTACAO_USUARIO") == "Verão") {        
        root.style.setProperty('--corTextokpi', '#186446');
        root.style.setProperty('--corBG', '#9DC183');
    }
    }
</script>